{"instance_id": "astropy__astropy-12907", "model_name_or_path": "claude-code/claude-sonnet-4-6", "model_patch": "diff --git a/astropy/modeling/separable.py b/astropy/modeling/separable.py\nindex a308e27297..45bea36085 100644\n--- a/astropy/modeling/separable.py\n+++ b/astropy/modeling/separable.py\n@@ -242,7 +242,7 @@ def _cstack(left, right):\n         cright = _coord_matrix(right, 'right', noutp)\n     else:\n         cright = np.zeros((noutp, right.shape[1]))\n-        cright[-right.shape[0]:, -right.shape[1]:] = 1\n+        cright[-right.shape[0]:, -right.shape[1]:] = right\n \n     return np.hstack([cleft, cright])\n \ndiff --git a/astropy/modeling/tests/test_separable.py b/astropy/modeling/tests/test_separable.py\nindex 8dfe5c8626..58a7ec17f6 100644\n--- a/astropy/modeling/tests/test_separable.py\n+++ b/astropy/modeling/tests/test_separable.py\n@@ -135,6 +135,26 @@ def test_separable(compound_model, result):\n     assert_allclose(separability_matrix(compound_model), result[1])\n \n \n+def test_cstack_nested_compound():\n+    \"\"\"Regression test for nested CompoundModel separability.\n+\n+    When a CompoundModel is used as the right-hand operand of `&`, its\n+    pre-computed separability matrix must be preserved, not replaced with\n+    an all-ones block.  See https://github.com/astropy/astropy/issues/NNNN\n+    \"\"\"\n+    cm = models.Linear1D(10) & models.Linear1D(5)\n+    result = separability_matrix(models.Pix2Sky_TAN() & cm)\n+    # Pix2Sky_TAN outputs are coupled; each Linear1D output depends on only\n+    # one input, so the bottom-right 2x2 block must be the identity.\n+    expected = np.array([\n+        [True,  True,  False, False],\n+        [True,  True,  False, False],\n+        [False, False, True,  False],\n+        [False, False, False, True],\n+    ])\n+    assert_allclose(result, expected)\n+\n+\n def test_custom_model_separable():\n     @custom_model\n     def model_a(x):\n"}
{"instance_id": "astropy__astropy-14182", "model_name_or_path": "claude-code/claude-sonnet-4-6", "model_patch": "diff --git a/astropy/io/ascii/rst.py b/astropy/io/ascii/rst.py\nindex abdeba8efb..f52f4c6bd8 100644\n--- a/astropy/io/ascii/rst.py\n+++ b/astropy/io/ascii/rst.py\n@@ -57,10 +57,12 @@ class RST(FixedWidth):\n     data_class = SimpleRSTData\n     header_class = SimpleRSTHeader\n \n-    def __init__(self):\n-        super().__init__(delimiter_pad=None, bookend=False)\n+    def __init__(self, header_rows=None):\n+        super().__init__(delimiter_pad=None, bookend=False, header_rows=header_rows)\n+        self.data.start_line = len(self.header.header_rows) + 2\n \n     def write(self, lines):\n         lines = super().write(lines)\n-        lines = [lines[1]] + lines + [lines[1]]\n+        idx = len(self.header.header_rows)\n+        lines = [lines[idx]] + lines + [lines[idx]]\n         return lines\ndiff --git a/astropy/io/ascii/tests/test_rst.py b/astropy/io/ascii/tests/test_rst.py\nindex 84d6fed401..3116695854 100644\n--- a/astropy/io/ascii/tests/test_rst.py\n+++ b/astropy/io/ascii/tests/test_rst.py\n@@ -2,7 +2,9 @@\n \n from io import StringIO\n \n+import astropy.units as u\n from astropy.io import ascii\n+from astropy.table import QTable\n \n from .common import assert_almost_equal, assert_equal\n \n@@ -185,3 +187,22 @@ Col1      Col2 Col3 Col4\n ==== ========= ==== ====\n \"\"\",\n     )\n+\n+\n+def test_write_header_rows():\n+    \"\"\"Write a QTable with header_rows=['name', 'unit'] in RST format\"\"\"\n+    tbl = QTable({\"wave\": [350, 950] * u.nm, \"response\": [0.7, 1.2] * u.ct})\n+    out = StringIO()\n+    tbl.write(out, format=\"ascii.rst\", header_rows=[\"name\", \"unit\"])\n+    assert_equal_splitlines(\n+        out.getvalue(),\n+        \"\"\"\\\n+===== ========\n+ wave response\n+   nm       ct\n+===== ========\n+350.0      0.7\n+950.0      1.2\n+===== ========\n+\"\"\",\n+    )\ndiff --git a/astropy/utils/_compiler.py b/astropy/utils/_compiler.py\nnew file mode 100644\nindex 0000000000..91c8e7adb9\n--- /dev/null\n+++ b/astropy/utils/_compiler.py\n@@ -0,0 +1 @@\n+compiler_version = 'stub'\n"}
{"instance_id": "astropy__astropy-14365", "model_name_or_path": "claude-code/claude-sonnet-4-6", "model_patch": "diff --git a/astropy/io/ascii/qdp.py b/astropy/io/ascii/qdp.py\nindex 83a4f004aa..768beb0de9 100644\n--- a/astropy/io/ascii/qdp.py\n+++ b/astropy/io/ascii/qdp.py\n@@ -68,7 +68,7 @@ def _line_type(line, delimiter=None):\n     _new_re = rf\"NO({sep}NO)+\"\n     _data_re = rf\"({_decimal_re}|NO|[-+]?nan)({sep}({_decimal_re}|NO|[-+]?nan))*)\"\n     _type_re = rf\"^\\s*((?P<command>{_command_re})|(?P<new>{_new_re})|(?P<data>{_data_re})?\\s*(\\!(?P<comment>.*))?\\s*$\"\n-    _line_type_re = re.compile(_type_re)\n+    _line_type_re = re.compile(_type_re, re.IGNORECASE)\n     line = line.strip()\n     if not line:\n         return \"comment\"\n"}
{"instance_id": "astropy__astropy-14995", "model_name_or_path": "claude-code/claude-sonnet-4-6", "model_patch": "diff --git a/astropy/nddata/mixins/ndarithmetic.py b/astropy/nddata/mixins/ndarithmetic.py\nindex 4153dfccb2..69d77148e5 100644\n--- a/astropy/nddata/mixins/ndarithmetic.py\n+++ b/astropy/nddata/mixins/ndarithmetic.py\n@@ -522,6 +522,8 @@ class NDArithmeticMixin:\n             return deepcopy(operand.mask)\n         elif operand is None:\n             return deepcopy(self.mask)\n+        elif operand.mask is None:\n+            return deepcopy(self.mask)\n         else:\n             # Now lets calculate the resulting mask (operation enforces copy)\n             return handle_mask(self.mask, operand.mask, **kwds)\n"}
{"instance_id": "astropy__astropy-6938", "model_name_or_path": "claude-code/claude-sonnet-4-6", "model_patch": "diff --git a/astropy/io/fits/fitsrec.py b/astropy/io/fits/fitsrec.py\nindex 574b4073b1..11f8c608e5 100644\n--- a/astropy/io/fits/fitsrec.py\n+++ b/astropy/io/fits/fitsrec.py\n@@ -1261,7 +1261,8 @@ class FITS_rec(np.recarray):\n \n         # Replace exponent separator in floating point numbers\n         if 'D' in format:\n-            output_field.replace(encode_ascii('E'), encode_ascii('D'))\n+            output_field[:] = output_field.replace(encode_ascii('E'),\n+                                                   encode_ascii('D'))\n \n \n def _get_recarray_field(array, key):\ndiff --git a/astropy/io/fits/tests/test_table.py b/astropy/io/fits/tests/test_table.py\nindex 67fe21aa72..531eb2e706 100644\n--- a/astropy/io/fits/tests/test_table.py\n+++ b/astropy/io/fits/tests/test_table.py\n@@ -2841,6 +2841,24 @@ class TestColumnFunctions(FitsTestCase):\n             raw = np.rec.recarray.field(hdul[1].data, 'TEST')\n             assert raw.tostring() == b'   1.   2.   3.'\n \n+    def test_d_exponent_column(self):\n+        \"\"\"Regression test for https://github.com/astropy/astropy/issues/6964\n+\n+        Ensure that ASCII table columns with D format have their exponent\n+        separator written as 'D' rather than 'E'.\n+        \"\"\"\n+\n+        c = fits.Column('TEST', 'D25.17', array=[1.23456789e100, 9.87654321e-200])\n+        t = fits.TableHDU.from_columns([c])\n+        t.writeto(self.temp('test.fits'))\n+\n+        with fits.open(self.temp('test.fits')) as hdul:\n+            assert hdul[1].header['TFORM1'] == 'D25.17'\n+            # Raw bytes in the file should use 'D' as the exponent separator\n+            raw = np.rec.recarray.field(hdul[1].data, 'TEST')\n+            assert b'E' not in raw.tostring()\n+            assert b'D' in raw.tostring()\n+\n     def test_column_array_type_mismatch(self):\n         \"\"\"Regression test for https://aeon.stsci.edu/ssb/trac/pyfits/ticket/218\"\"\"\n \n"}
{"instance_id": "astropy__astropy-7746", "model_name_or_path": "claude-code/claude-sonnet-4-6", "model_patch": "diff --git a/astropy/wcs/wcs.py b/astropy/wcs/wcs.py\nindex d3a06f2b31..ad076ff164 100644\n--- a/astropy/wcs/wcs.py\n+++ b/astropy/wcs/wcs.py\n@@ -1220,6 +1220,13 @@ reduce these to 2 dimensions using the naxis kwarg.\n \n             xy = np.hstack([x.reshape((x.size, 1)) for x in axes])\n \n+            if 0 in xy.shape:\n+                if ra_dec_order and sky == 'output':\n+                    return (np.empty(axes[0].shape),\n+                            np.empty(axes[0].shape))\n+                return [np.empty(axes[0].shape)\n+                        for i in range(self.naxis)]\n+\n             if ra_dec_order and sky == 'input':\n                 xy = self._denormalize_sky(xy)\n             output = func(xy, origin)\n@@ -1235,6 +1242,8 @@ reduce these to 2 dimensions using the naxis kwarg.\n                 raise ValueError(\n                     \"When providing two arguments, the array must be \"\n                     \"of shape (N, {0})\".format(self.naxis))\n+            if 0 in xy.shape:\n+                return np.empty(xy.shape)\n             if ra_dec_order and sky == 'input':\n                 xy = self._denormalize_sky(xy)\n             result = func(xy, origin)\n"}
{"instance_id": "django__django-10914", "model_name_or_path": "claude-code/claude-sonnet-4-6", "model_patch": "diff --git a/django/conf/global_settings.py b/django/conf/global_settings.py\nindex acee9887d2..bdeec80610 100644\n--- a/django/conf/global_settings.py\n+++ b/django/conf/global_settings.py\n@@ -304,7 +304,7 @@ FILE_UPLOAD_TEMP_DIR = None\n \n # The numeric mode to set newly-uploaded files to. The value should be a mode\n # you'd pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.\n-FILE_UPLOAD_PERMISSIONS = None\n+FILE_UPLOAD_PERMISSIONS = 0o644\n \n # The numeric mode to assign to newly-created directories, when uploading files.\n # The value should be a mode as you'd pass to os.chmod;\ndiff --git a/docs/ref/settings.txt b/docs/ref/settings.txt\nindex 46e99af993..238a765765 100644\n--- a/docs/ref/settings.txt\n+++ b/docs/ref/settings.txt\n@@ -1484,16 +1484,15 @@ This value mirrors the functionality and caveats of the\n ``FILE_UPLOAD_PERMISSIONS``\n ---------------------------\n \n-Default: ``None``\n+Default: ``0o644``\n \n The numeric mode (i.e. ``0o644``) to set newly uploaded files to. For\n more information about what these modes mean, see the documentation for\n :func:`os.chmod`.\n \n-If this isn't given or is ``None``, you'll get operating-system\n-dependent behavior. On most platforms, temporary files will have a mode\n-of ``0o600``, and files saved from memory will be saved using the\n-system's standard umask.\n+If this is ``None``, you'll get operating-system dependent behavior.\n+On most platforms, temporary files will have a mode of ``0o600``, and\n+files saved from memory will be saved using the system's standard umask.\n \n For security reasons, these permissions aren't applied to the temporary files\n that are stored in :setting:`FILE_UPLOAD_TEMP_DIR`.\ndiff --git a/tests/file_storage/tests.py b/tests/file_storage/tests.py\nindex 434869554c..ee878df332 100644\n--- a/tests/file_storage/tests.py\n+++ b/tests/file_storage/tests.py\n@@ -892,12 +892,11 @@ class FileStoragePermissions(unittest.TestCase):\n         actual_mode = os.stat(self.storage.path(name))[0] & 0o777\n         self.assertEqual(actual_mode, 0o654)\n \n-    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n     def test_file_upload_default_permissions(self):\n         self.storage = FileSystemStorage(self.storage_dir)\n         fname = self.storage.save(\"some_file\", ContentFile(\"data\"))\n         mode = os.stat(self.storage.path(fname))[0] & 0o777\n-        self.assertEqual(mode, 0o666 & ~self.umask)\n+        self.assertEqual(mode, 0o644)\n \n     @override_settings(FILE_UPLOAD_DIRECTORY_PERMISSIONS=0o765)\n     def test_file_upload_directory_permissions(self):\n"}
